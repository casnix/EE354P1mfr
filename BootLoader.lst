Y:\Development\8051\Bootstrapper\BootLoader.xsf 
Y:\Development\8051\Bootstrapper\BootLoader.asm 
       1       1   00000                  ; Matt Rienzo, HILStrapper.inc 8/25/2018
       2       2   00000                  
../include/asm/Registers.inc 
       4       1   00000                  ; Matt Rienzo, Registers.inc 8/25/2018
       5       2   00000                  
       6       3   00000                  ;-- Alias/enumeration of registers and banks
       7       4   00000                  a0	equ	0
       8       5   00000                  a1	equ	1
       9       6   00000                  a2	equ	2
      10       7   00000                  a3	equ	3
      11       8   00000                  a4	equ	4
      12       9   00000                  a5	equ	5
      13      10   00000                  a6	equ	6
      14      11   00000                  a7	equ	7
      15      12   00000                  b0	equ	8
      16      13   00000                  b1	equ	9
      17      14   00000                  b2	equ	10
      18      15   00000                  b3	equ	11
      19      16   00000                  b4	equ	12
      20      17   00000                  b5	equ	13
      21      18   00000                  b6	equ	14
      22      19   00000                  b7	equ	15
      23      20   00000                  c0	equ	16
      24      21   00000                  c1	equ	17
      25      22   00000                  c2	equ	18
      26      23   00000                  c3	equ	19
      27      24   00000                  c4	equ	20
      28      25   00000                  c5	equ	21
      29      26   00000                  c6	equ	22
      30      27   00000                  c7	equ	23
      31      28   00000                  
      32      29   00000                  ;-- SFRs
      33      30   00000                  sp  equ 0x81
      34      31   00000                  acc equ 0xe0
      35      32   00000                  bcc equ 0xf0
      36      33   00000                  psw equ 0xd0
../include/asm/ShortStack.inc 
      38       1   00000                  ; Matt Rienzo, ShortStack.inc 8/25/2018
      39       2   00000                  
      40       3   00000                  ; The following registers I am reserving for short stack operations
      41       4   00000                  s0	equ	0x18
      42       5   00000                  s1	equ	0x19
      43       6   00000                  s2	equ	0x1a
      44       7   00000                  s3	equ 0x1b
      45       8   00000                  s4	equ	0x1c
      46       9   00000                  s5	equ	0x1d
      47      10   00000                  s6	equ	0x1e
      48      11   00000                  s7	equ	0x1f
      49      12   00000                  
      50      13   00000                  
      51      14   00000                  ; SHORT STACK -- see the Short Stack section after the END instruction for an explanation
      52      15   00000                  ;  of what this is
      53      16   00000                  ; Short stack address "register" and short stack size "register"
      54      17   00000                  ss	equ	0x20	; short stack 0 address
      55      18   00000                  ssz	equ 0x21	; short stack size (index)
      56      19   00000                  msz	equ	0x22	; short stack max size (to avoid overflow, but with stack wrapping/overwrites)
ADC.inc 
      58       1   00000                  ; ------------- READS51 generated header --------------
      59       2   00000                  ; module  : Y:\Development\8051\Bootstrapper\Bootstrapper\ADC.inc
      60       3   00000                  ; created : 11:09:44, Monday, August 27, 2018
      61       4   00000                  ; -----------------------------------------------------
      62       5   00000                  
      63       6   00000                  ; Matt Rienzo, ADC.inc 8/27/2018
      64       7   00000                  
      65       8   00000                  ; Direct memory addressing
      66       9   00000                  adcon       equ 0xf3
      67      10   00000                  adcf        equ 0xf6
      68      11   00000                  adclk       equ 0xf2
      69      12   00000                  addh        equ 0xf5
      70      13   00000                  addl        equ 0xf4
InterruptController.inc 
      72       1   00000                  ; ------------- READS51 generated header --------------
      73       2   00000                  ; module  : Y:\Development\8051\Bootstrapper\Bootstrapper\InterruptController.inc
      74       3   00000                  ; created : 11:26:26, Monday, August 27, 2018
      75       4   00000                  ; -----------------------------------------------------
      76       5   00000                  
      77       6   00000                  ; Matt Rienzo, InterruptController.inc
      78       7   00000                  
      79       8   00000                  ien0    equ 0xa8
      80       9   00000                  ien1    equ 0xe8
      81      10   00000                  ipl0    equ 0xb8
      82      11   00000                  iph0    equ 0xb7
      83      12   00000                  ipl1    equ 0xf8
      84      13   00000                  iph1    equ 0xf7
      85      14   00000                  
Y:\Development\8051\Bootstrapper\BootLoader.asm 
      86       7   00000                  
      87      15   00000                  
      88      16   00000                  ;#define OPTIMIZE
      89      18   00000                  
      90      19   00000                  HIL		segment	code
      91      20   00000                  
      92      21   00000                  public	__HIL_init
      93      22   00000                  public	main
      94      23   00000                  rseg	HIL
      95      24   00000                      extern  code    __sspop
      96      25   00000                      extern  code    __sspush
      97      26   00000                  	__HIL_init:
      98      27   00000                          ; 1) Turn on ADC.
      99      28   00000 75F601                   mov     adcf,       #0x01
     100      29   00003 75F320                   mov     adcon,      #0x20
     101      30   00006 75F200                   mov     adclk,      #0x00
     102      32   00009 85F617                   mov     c7,         adcf
     103      33   0000C 85F316                   mov     c6,         adcon
     104      34   0000F 85F215                   mov     c5,         adclk
     105      36   00012                  
     106      37   00012                          ; Disable interrupts for while we check devices on ADC
     107      38   00012 53A87F                   lowEA
     108      39   00015                          ; 2) Check battery voltage.  Too low? Turn on red square and battery low LEDs.
     109      40   00015                          ; battery voltage/division will be routed to ADC channel 0
     110      41   00015 53F3F8                   anl     adcon,      #0xf8
     111      42   00018 43F300                   orl     adcon,      #0x00
     112      43   0001B 43F320                   orl     adcon,      #0x20
     113      44   0001E                  
     114      45   0001E                          ; Start the ADC collection
     115      46   0001E 43F308                   orl     adcon,      #0x08
     116      47   00021 C0E0                     push    acc
     117      48   00023                      hsWdbADCON:
     118      49   00023 E5F3                     mov     a,          adcon
     119      50   00025 5510                     anl     a,          0x10
     120      51   00027 B510F9                   cjne    a,          0x10,   hsWdbADCON
     121      52   0002A                  
     122      53   0002A                          ; Voltage check
     123      54   0002A                  #define     MINIMUM_BATT_VOLTAGEh   0x0f    ; will change
     124      56   0002A C0F0                     push    bcc
     125      58   0002C 74FF                     mov     a,          #0xff
     126      59   0002E 7400                     mov     a,          #0x00
     127      60   00030 74FF                     mov     a,          #0xff
     128      61   00032                      dbgloop:
     129      62   00032 C3                       clr     c
     130      63   00033 E50F                     mov     a,          0x0f
     131      64   00035 940F                     subb    a,          #MINIMUM_BATT_VOLTAGEh
     132      65   00037                         ; mov     a,          c
     133      66   00037                  
     134      67   00037                  
     135      68   00037                      dbgdo:
     136      69   00037 80F9                     sjmp    dbgloop
     137      71   00039                  
     138      72   00039                  
     139      73   00039                          ; 3) Turn on accelerometer
     140      74   00039                          ; 4) Switch interrupts?
     141      75   00039                          ; 5) Return success
     142      76   00039                          ; Handler for turning on LEDs
     143      77   00039                          ; Handler for LED array
     144      78   00039                          ; Handler for power touch button
     145      79   00039                          ; Handler for battery power measuring
     146      80   00039                          ; Handler for accelerometer
     147      81   00039                          ; Handler for vibration motor
     148      82   00039 751800                   sspushl(0x00)
     149      83   0003C C018               		ret
     150      84   0003E 120000           
                         0000000840      
     151      85   00041 22               	main:
     152      86   00042                  		; Order of operation:
     153      87   00042 22               		ret
     154      88   00043                  
     155      89   00043                  
     156      90   00043                  end


*** Symbols ***
name                    hex      dec          type     segment
--------------------------------------------------------------
ss                   0x0020       32        number     absolute
c0                   0x0010       16        number     absolute
s0                   0x0018       24        number     absolute
c1                   0x0011       17        number     absolute
b0                   0x0008        8        number     absolute
iph0                 0x00B7      183        number     absolute
ien0                 0x00A8      168        number     absolute
s1                   0x0019       25        number     absolute
c2                   0x0012       18        number     absolute
b1                   0x0009        9        number     absolute
a0                   0x0000        0        number     absolute
__HIL_init           0x0000        0          code     HIL
iph1                 0x00F7      247        number     absolute
ien1                 0x00E8      232        number     absolute
ssz                  0x0021       33        number     absolute
s2                   0x001A       26        number     absolute
c3                   0x0013       19        number     absolute
b2                   0x000A       10        number     absolute
a1                   0x0001        1        number     absolute
s3                   0x001B       27        number     absolute
c4                   0x0014       20        number     absolute
b3                   0x000B       11        number     absolute
a2                   0x0002        2        number     absolute
s4                   0x001C       28        number     absolute
c5                   0x0015       21        number     absolute
b4                   0x000C       12        number     absolute
a3                   0x0003        3        number     absolute
adcf                 0x00F6      246        number     absolute
s5                   0x001D       29        number     absolute
c6                   0x0016       22        number     absolute
b5                   0x000D       13        number     absolute
a4                   0x0004        4        number     absolute
addh                 0x00F5      245        number     absolute
s6                   0x001E       30        number     absolute
c7                   0x0017       23        number     absolute
b6                   0x000E       14        number     absolute
a5                   0x0005        5        number     absolute
s7                   0x001F       31        number     absolute
b7                   0x000F       15        number     absolute
a6                   0x0006        6        number     absolute
a7                   0x0007        7        number     absolute
main                 0x0042       66          code     HIL
hsWdbADCON           0x0023       35          code     HIL
adclk                0x00F2      242        number     absolute
adcon                0x00F3      243        number     absolute
dbgloop              0x0032       50          code     HIL
addl                 0x00F4      244        number     absolute
acc                  0x00E0      224        number     absolute
bcc                  0x00F0      240        number     absolute
dbgdo                0x0037       55          code     HIL
msz                  0x0022       34        number     absolute
psw                  0x00D0      208        number     absolute
sp                   0x0081      129        number     absolute
ipl0                 0x00B8      184        number     absolute
ipl1                 0x00F8      248        number     absolute


*** Externals (Imports) ***
name                    hex      dec          type
--------------------------------------------------
__sspush             0x0000        0          code 
__sspop              0x0000        0          code 


*** Publics (Exports) ***
name                    hex      dec          type
--------------------------------------------------
__HIL_init           0x0000        0          code 
main                 0x0042       66          code 
